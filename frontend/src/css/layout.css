/* === Layout & Panel Styles === */
@layer components {

    /* App Container & Hero */
    .app {
        @apply min-h-screen p-8 max-w-7xl mx-auto;
    }

    /* Global Navbar (V3) */
    .app-sticky-header {
        @apply sticky top-0 z-50 bg-white border-b-2 border-blue-600/10 -mx-8 px-8 py-3 mb-6 shadow-md;
    }

    .navbar {
        @apply flex items-center justify-between gap-6 max-w-7xl mx-auto;
    }

    .navbar-brand {
        @apply flex items-center gap-2;
    }

    .brand-logo {
        @apply text-xl;
    }

    .brand-name {
        @apply text-lg font-black text-slate-950 tracking-tight;
    }

    /* Dot Stepper Nav */
    .navbar-nav {
        @apply flex-1 flex justify-center;
    }

    .dot-stepper {
        @apply flex items-center gap-10 bg-slate-50 px-6 py-2 rounded-full border border-slate-100;
    }

    .dot-node {
        @apply flex items-center gap-2 opacity-40 transition-all duration-300;
    }

    .dot-node.is-current {
        @apply opacity-100;
    }

    .dot-node.is-done {
        @apply opacity-70;
    }

    .dot-node .dot {
        @apply w-2 h-2 rounded-full bg-slate-300 transition-all duration-300;
    }

    .dot-node.is-current .dot {
        @apply w-3 h-3 bg-blue-600 shadow-lg shadow-blue-500/50 ring-4 ring-blue-500/20 scale-110;
    }

    .dot-node.is-done .dot {
        @apply bg-blue-400;
    }

    .dot-label {
        @apply text-xs font-bold text-slate-500;
    }

    /* Navbar Actions */
    .navbar-actions {
        @apply flex items-center gap-6;
    }

    .mini-status {
        @apply flex items-center gap-2 px-3 py-1 bg-blue-50/50 rounded-lg text-[11px] font-bold text-blue-600;
    }

    .action-btns {
        @apply flex gap-2;
    }

    .nav-btn {
        @apply px-3 py-1.5 rounded-lg border border-slate-200 text-xs font-bold text-slate-600 hover:bg-slate-50 transition-all;
    }

    .nav-btn.primary {
        @apply bg-slate-900 border-slate-900 text-white hover:bg-slate-800;
    }

    /* Language Selector Custom Dropdown */
    .lang-btn {
        @apply w-9 h-9 flex items-center justify-center rounded-md border border-slate-200 bg-white hover:bg-slate-50 transition-all cursor-pointer;
        @apply shadow-sm hover:shadow-md hover:border-blue-200;
    }

    .nav-icon-btn {
        @apply w-9 h-9 flex items-center justify-center rounded-md border border-slate-200 bg-white hover:bg-slate-50 transition-all cursor-pointer;
        @apply shadow-sm hover:shadow-md hover:border-blue-200 text-lg text-slate-600;
    }

    .lang-menu {
        @apply absolute top-full right-0 mt-2 w-40 bg-white rounded-xl shadow-xl border border-slate-100 p-1.5 z-50 flex flex-col gap-1;
        animation: menu-slide-in 0.2s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .lang-item {
        @apply flex items-center gap-3 px-3 py-2 rounded-lg text-slate-600 hover:bg-blue-50 hover:text-blue-600 transition-colors text-left w-full;
    }

    .lang-item.active {
        @apply bg-blue-50 text-blue-700 font-bold;
    }

    @keyframes menu-slide-in {
        from {
            opacity: 0;
            transform: translateY(-8px) scale(0.98);
        }

        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }

    /* Pulse Blue Anim */
    .pulse-blue {
        @apply w-1.5 h-1.5 rounded-full bg-blue-500;
        animation: pulse-blue-dot 2s infinite;
    }

    @keyframes pulse-blue-dot {
        0% {
            transform: scale(0.95);
            opacity: 0.8;
        }

        50% {
            transform: scale(1.2);
            opacity: 1;
        }

        100% {
            transform: scale(0.95);
            opacity: 0.8;
        }
    }

    /* Grid Layout */
    .main-grid {
        display: grid;
        gap: 1.5rem;
        grid-template-columns: 320px 1fr;
    }

    /* Panels (Modern Sleek Glassmorphism) */
    .panel {
        @apply bg-white/70 backdrop-blur-md rounded-2xl p-6 shadow-2xl shadow-slate-200/40 border border-white/40 flex flex-col relative overflow-hidden transition-all;
    }

    .panel-left {
        @apply border-r border-slate-200/50 shadow-none bg-slate-50/40 backdrop-blur-lg p-5;
        height: calc(100vh - 12rem);
    }

    .panel-right {
        @apply gap-4 p-6 bg-white/60 backdrop-blur-md;
        height: calc(100vh - 12rem);
    }

    /* Panel Header Titles (引導導航, 文字區塊) */
    .panel-header {
        @apply mb-0 pb-1 border-b border-slate-200;
    }

    .panel-header h2 {
        @apply text-lg font-extrabold text-slate-800 tracking-tight;
    }

    .panel-header p {
        @apply text-xs text-slate-500 mt-1 font-medium;
    }

    .sidebar-scrollable-content {
        @apply flex-1 overflow-y-auto flex flex-col gap-4 mt-4;
    }

    /* Accordion Styles */
    .accordion-section {
        @apply border border-transparent last:border-b-0 py-1 transition-all duration-300 rounded-xl mb-1 relative;
        /* 移除 overflow-hidden 以免裁剪陰影與內容 */
    }

    /* 連貫導軌虛擬元素 */
    .accordion-section::after {
        content: "";
        @apply absolute left-[26px] top-10 bottom-0 w-[1px] bg-slate-200 -z-10;
        display: none;
        /* 預設隱藏，僅在非最後一項顯示 */
    }

    .accordion-section:not(:last-child)::after {
        display: block;
    }

    .accordion-section.is-open {
        @apply bg-white shadow-lg shadow-slate-200/50 py-3 border-slate-100;
        /* 活性導航軌 */
        border-left: 3px solid theme('colors.blue.500');
    }

    .accordion-section.is-done:not(.is-open) {
        @apply border-transparent;
    }

    .accordion-header {
        @apply flex items-center justify-between w-full px-4 py-2.5 text-left font-bold text-slate-500 hover:text-blue-600 transition-all cursor-pointer;
    }

    .is-open .accordion-header {
        @apply text-slate-900 text-sm tracking-tight;
    }

    .is-done .accordion-header {
        @apply text-blue-600/80;
    }

    .accordion-content {
        @apply overflow-hidden transition-all duration-300 ease-in-out px-4;
    }

    .accordion-indicator {
        @apply text-slate-300 transition-transform duration-300;
    }

    .is-open .accordion-indicator {
        @apply transform rotate-180 text-blue-500;
    }

    .ai-settings-panel {
        @apply bg-blue-50/40 border border-blue-100/50 rounded-2xl p-4 mt-1 transition-all duration-300;
    }

    /* Pills */
    .pill {
        @apply inline-block px-2 py-0.5 rounded-full bg-slate-100 text-slate-500 text-xs font-medium;
    }

    .mini-status {
        @apply flex items-center gap-2 px-3 py-1.5 rounded-full bg-slate-50 border border-slate-200;
        @apply w-full max-w-[160px] md:max-w-[200px] transition-all duration-300;
    }

    .mini-status.is-error {
        @apply bg-rose-50 border-rose-200 text-rose-600;
    }

    .mini-status.is-error .dot {
        @apply bg-rose-500 shadow-sm shadow-rose-500/50;
        animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;
    }

    .status-text {
        @apply text-xs font-medium truncate whitespace-nowrap overflow-hidden;
    }

    .block-meta {
        @apply flex items-center gap-2 border-b border-slate-200 bg-slate-50/50 text-[11px] text-slate-500 font-medium;
        /* 移除 px-3，改由外層 block-card 的 p-3 統一控制寬度 */
        @apply p-0 pb-1.5 mb-2;
    }

    .btn-tool {
        @apply flex items-center gap-1.5 px-2 py-0.5 rounded-md border border-transparent;
        @apply bg-transparent text-slate-500 transition-all duration-200 cursor-pointer;
        @apply hover:bg-white hover:border-slate-300 hover:text-blue-600 hover:shadow-sm;
    }

    .btn-tool .icon {
        @apply text-sm opacity-80;
    }

    .status-pill {
        @apply inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-blue-50 text-blue-600 text-xs font-medium;
    }

    .status-pill.is-running {
        @apply bg-amber-50 text-amber-600;
    }

    /* Block List */
    .block-list {
        @apply flex-1 overflow-y-auto pr-2 flex flex-col gap-3;
        margin-right: -0.5rem;
        padding-right: 0.5rem;
    }

    /* Block Cards (Compact Header) */
    .block-card {
        @apply bg-white border border-slate-300 rounded-lg p-3 flex flex-col gap-2 shadow-sm hover:shadow-md hover:border-blue-400/50 transition-all duration-200;
    }

    .block-card.is-muted {
        @apply opacity-50;
    }

    .block-meta {
        /* 此處原本有重複定義，已合併至上方 */
    }

    .block-actions {
        @apply flex gap-2 pt-3 border-t border-slate-100;
    }

    .block-body {
        @apply grid grid-cols-2 gap-3;
    }

    /* Filter Row Compact */
    .filter-row {
        @apply flex gap-3 items-center flex-wrap pt-0.5 pb-1.5 border-b border-slate-200/50;
    }

    .filter-item {
        @apply flex flex-row items-center gap-2;
    }

    .filter-item .field-label {
        @apply m-0 text-xs text-slate-400 whitespace-nowrap;
    }

    /* Data Table */
    .data-table {
        @apply border border-slate-200 rounded-xl overflow-hidden;
    }

    .data-table.is-glossary .data-row {
        grid-template-columns: 100px 100px minmax(120px, 1.5fr) minmax(120px, 1.5fr) 80px 120px;
    }

    .data-table.is-tm .data-row {
        grid-template-columns: 100px 100px minmax(120px, 1fr) minmax(120px, 1fr) 120px;
    }

    .data-header {
        @apply bg-slate-50 border-b border-slate-200 font-bold text-xs uppercase tracking-wider text-slate-500;
    }

    .data-header .data-cell {
        @apply py-4 whitespace-nowrap;
    }

    .data-row {
        @apply grid border-b border-slate-200 last:border-b-0 transition-colors duration-150;
    }

    .data-row:hover {
        @apply bg-slate-50/50;
    }

    .data-cell {
        @apply px-4 py-4 flex items-center text-sm text-slate-700 overflow-hidden min-h-[56px];
        word-break: break-word;
    }

    .data-cell.data-actions {
        @apply flex gap-1 items-center justify-end px-2;
    }

    .action-btn-sm {
        @apply w-8 h-8 rounded-lg flex items-center justify-center text-lg transition-all duration-200 hover:bg-slate-100;
    }

    .action-btn-sm.primary {
        @apply text-blue-600 hover:bg-blue-50;
    }

    .action-btn-sm.danger {
        @apply text-rose-500 hover:bg-rose-50;
    }

    .action-btn-sm.success {
        @apply text-emerald-600 hover:bg-emerald-50;
    }

    .action-btn-sm.ghost {
        @apply text-slate-400 hover:bg-slate-100 hover:text-slate-600;
    }

    .data-input {
        @apply w-full h-8 px-2 rounded border border-slate-200 text-sm focus:outline-none focus:border-blue-500;
    }

    .data-empty {
        @apply text-center py-8 text-slate-400 text-sm;
    }

    /* Action Row */
    .action-row {
        @apply flex gap-3 flex-wrap items-center py-1 mb-1;
    }

    /* Create Row */
    .create-row {
        @apply flex gap-4 items-end py-2 border-b border-slate-200;
    }

    .create-fields {
        @apply w-full;
    }

    .create-fields .select-input,
    .create-fields .text-input {
        @apply w-full h-9 py-1 px-2 text-sm;
    }

    /* Token Stats Component */
    .token-stats {
        @apply relative;
    }

    .token-stats-toggle {
        @apply flex items-center gap-2 px-3 py-1.5 bg-slate-100 hover:bg-slate-200 rounded-md text-sm font-medium transition-colors cursor-pointer border-none;
    }

    .token-icon {
        @apply text-base;
    }

    .token-count {
        @apply text-slate-700;
    }

    .token-cost {
        @apply text-emerald-600 font-semibold;
    }

    .token-stats-dropdown {
        @apply absolute top-full right-0 mt-2 w-72 bg-white rounded-xl shadow-2xl border border-slate-200 z-50 overflow-hidden;
    }

    .token-stats-header {
        @apply flex justify-between items-center px-4 py-3 bg-gradient-to-r from-indigo-500 to-purple-500 text-white;
    }

    .token-stats-header h4 {
        @apply font-bold text-sm;
    }

    .token-stats-header .close-btn {
        @apply w-6 h-6 flex items-center justify-center text-white/80 hover:text-white hover:bg-white/20 rounded-full cursor-pointer border-none bg-transparent;
    }

    .token-stats-section {
        @apply px-4 py-3 border-b border-slate-100 last:border-b-0;
    }

    .token-stats-section h5 {
        @apply text-xs font-semibold text-slate-500 mb-2;
    }

    .stats-grid {
        @apply grid grid-cols-2 gap-2;
    }

    .stat-item {
        @apply flex flex-col;
    }

    .stat-label {
        @apply text-xs text-slate-400;
    }

    .stat-value {
        @apply text-lg font-bold text-slate-700;
    }

    .stat-value.highlight {
        @apply text-indigo-600;
    }

    .stat-value.cost {
        @apply text-emerald-600;
    }

    .stat-hint {
        @apply text-xs text-slate-400 mt-2;
    }

    .stats-row {
        @apply flex justify-between text-sm text-slate-600;
    }

    .model-tags {
        @apply flex flex-wrap gap-1;
    }

    .model-tag {
        @apply px-2 py-0.5 bg-slate-100 text-slate-600 text-xs rounded-full;
    }

    /* --- Progress Bar --- */
    .navbar-progress-bar {
        @apply absolute bottom-0 left-0 w-full h-[3px] bg-slate-100/50 overflow-hidden;
    }

    .navbar-progress-inner {
        @apply h-full bg-blue-500 transition-all duration-500 ease-out;
        box-shadow: 0 0 8px rgba(59, 130, 246, 0.5);
    }

    /* --- Block Card Animations --- */
    .block-card.is-translating {
        @apply border-blue-400 bg-blue-50/20 shadow-lg shadow-blue-500/5;
        animation: card-pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    @keyframes card-pulse {

        0%,
        100% {
            opacity: 1;
            transform: scale(1);
        }

        50% {
            opacity: 0.9;
            transform: scale(0.998);
            border-color: #60a5fa;
        }
    }
}
